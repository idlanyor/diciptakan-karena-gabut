// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Panel Users (Admin/Staff)
model User {
  id          Int      @id @default(autoincrement())
  nama        String
  username    String   @unique
  jabatan     String
  role        String
  fotoProfil  String?  @map("foto_profil")
  password    String
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  posts       Post[]

  @@map("users")
}

// Student Users (Pendaftar)
model StudentUser {
  id              Int       @id @default(autoincrement())
  namaLengkap     String    @map("nama_lengkap")
  email           String
  tglLahir        String    @map("tgl_lahir")
  status          Int
  tglDaftar       DateTime  @map("tgl_daftar") @db.Date
  tglDiterima     DateTime? @map("tgl_diterima") @db.Date
  gelombang       String
  jalurPendaftaran String   @map("jalur_pendaftaran")
  password        String
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  biodataUmum     BiodataUmum?
  biodataLain     BiodataLain?
  filePendaftar   FilePendaftar?
  tahapanProses   TahapanProsesPendaftar[]

  @@map("pd_users")
}

// Biodata Umum
model BiodataUmum {
  id              Int         @id @default(autoincrement())
  namaLengkap     String      @map("nama_lengkap")
  nik             String
  jk              JenisKelamin @default(LAKI_LAKI)
  tmptLahir       String      @map("tmpt_lahir")
  tglLahir        DateTime    @map("tgl_lahir") @db.Date
  agama           String
  kewarganegaraan String
  addrProv        String      @map("addr_prov")
  addrKab         String      @map("addr_kab")
  addrKec         String      @map("addr_kec")
  addrDes         String      @map("addr_des")
  addrRt          String      @map("addr_rt")
  addrRw          String      @map("addr_rw")
  idPendaftar     Int         @unique @map("id_pendaftar")
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  pendaftar       StudentUser @relation(fields: [idPendaftar], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("pd_biodata_umum")
}

enum JenisKelamin {
  LAKI_LAKI @map("Laki - laki")
  PEREMPUAN @map("Perempuan")
}

// Biodata Lain
model BiodataLain {
  id           Int         @id @default(autoincrement())
  asalSekolah  String      @map("asal_sekolah")
  nisn         String
  nmBapak      String      @map("nm_bapak")
  nmIbu        String      @map("nm_ibu")
  pkjAyah      Int         @map("pkj_ayah")
  pkjIbu       Int         @map("pkj_ibu")
  penghAyah    Int         @map("pengh_ayah")
  penghIbu     Int         @map("pengh_ibu")
  pendTAyah    Int         @map("pend_t_ayah")
  pendTIbu     Int         @map("pend_t_ibu")
  idPendaftar  Int         @unique @map("id_pendaftar")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  pendaftar    StudentUser @relation(fields: [idPendaftar], references: [id], onDelete: Cascade, onUpdate: Cascade)
  pekerjaanAyah CatPekerjaanAyah @relation(fields: [pkjAyah], references: [id], onDelete: Cascade, onUpdate: Cascade)
  pekerjaanIbu  CatPekerjaanIbu @relation(fields: [pkjIbu], references: [id], onDelete: Cascade, onUpdate: Cascade)
  penghasilanAyah CatPenghasilan @relation("PenghasilanAyah", fields: [penghAyah], references: [id], onDelete: Cascade, onUpdate: Cascade)
  penghasilanIbu  CatPenghasilan @relation("PenghasilanIbu", fields: [penghIbu], references: [id], onDelete: Cascade, onUpdate: Cascade)
  pendidikanAyah  CatPendTerakhir @relation("PendidikanAyah", fields: [pendTAyah], references: [id], onDelete: Cascade, onUpdate: Cascade)
  pendidikanIbu   CatPendTerakhir @relation("PendidikanIbu", fields: [pendTIbu], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("pd_biodata_lain")
}

// File Pendaftar
model FilePendaftar {
  id          Int         @id @default(autoincrement())
  kk          String?
  ijazah      String?
  skl         String?
  pasfoto     String?
  idPendaftar Int         @unique @map("id_pendaftar")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  pendaftar   StudentUser @relation(fields: [idPendaftar], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("file_pendaftar")
}

// Gelombang Pendaftaran
model GelombangPendaftaran {
  id            Int      @id @default(autoincrement())
  gelombangKe   String   @map("gelombang_ke")
  isAktif       Int      @map("isAktif")
  tahunPelajaran String  @map("tahun_pelajaran")
  periodeMulai  String   @map("periode_mulai")
  periodeAkhir  String   @map("periode_akhir")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("gelombang_pendaftaran")
}

// Jalur Pendaftaran
model JalurPendaftaran {
  id         Int      @id @default(autoincrement())
  namaJalur  String   @map("nama_jalur")
  kuota      String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("jalur_pendaftaran")
}

// Posts (Pengumuman, Jadwal, dll)
model Post {
  id        Int      @id @default(autoincrement())
  tgl       DateTime @db.Date
  judul     String
  isi       String   @db.Text
  lampiran  String
  author    Int
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user      User     @relation(fields: [author], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("posts")
}

// Tahapan Proses
model TahapanProses {
  id        Int      @id @default(autoincrement())
  proses    String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  tahapanProsesPendaftar TahapanProsesPendaftar[]

  @@map("tahapan_proses")
}

// Tahapan Proses Pendaftar
model TahapanProsesPendaftar {
  id          Int      @id @default(autoincrement())
  idPendaftar Int      @map("id_pendaftar")
  idTahapan   Int      @map("id_tahapan")
  status      Int
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  pendaftar   StudentUser @relation(fields: [idPendaftar], references: [id], onDelete: Cascade, onUpdate: Cascade)
  tahapan     TahapanProses @relation(fields: [idTahapan], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("tahapan_proses_pendaftars")
}

// Tahun Akademik
model TahunAkademik {
  id        Int      @id @default(autoincrement())
  tahun     String
  isAktif   Int      @map("isAktif")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("tahun_akademiks")
}

// Category Tables
model CatPekerjaanAyah {
  id        Int      @id @default(autoincrement())
  nama      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  biodataLain BiodataLain[]

  @@map("cat_pekerjaan_ayah")
}

model CatPekerjaanIbu {
  id        Int      @id @default(autoincrement())
  nama      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  biodataLain BiodataLain[]

  @@map("cat_pekerjaan_ibu")
}

model CatPenghasilan {
  id        Int      @id @default(autoincrement())
  nama      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  biodataLainAyah BiodataLain[] @relation("PenghasilanAyah")
  biodataLainIbu  BiodataLain[] @relation("PenghasilanIbu")

  @@map("cat_penghasilan")
}

model CatPendTerakhir {
  id        Int      @id @default(autoincrement())
  nama      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  biodataLainAyah BiodataLain[] @relation("PendidikanAyah")
  biodataLainIbu  BiodataLain[] @relation("PendidikanIbu")

  @@map("cat_pend_terakhir")
}

model CatAgama {
  id        Int      @id @default(autoincrement())
  nama      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("cat_agama")
}
